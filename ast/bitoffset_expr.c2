/* Copyright 2022 Bas van den Berg
*/

module ast;

import ast_context;
import string_buffer;
import src_loc local;

/*
public type BitOffsetExprBits struct {
    u32 : NumExprBits;
    u32 kind : 5;
}
*/

public type BitOffsetExpr struct {
    Expr parent;
    Expr* lhs;
    Expr* rhs;
} @(opaque)

public func BitOffsetExpr* BitOffsetExpr.create(ast_context.Context* c, SrcLoc loc, Expr* lhs, Expr* rhs) @(inline) {
    BitOffsetExpr* e = c.alloc(sizeof(BitOffsetExpr));
    e.parent.init(ExprKind.BitOffset, loc, 0, 0, 0, ValType.RValue);
    e.lhs = lhs;
    e.rhs = rhs;
#if AstStatistics
    Stats.addExpr(ExprKind.BitOffset, sizeof(BitOffsetExpr));
#endif
    return e;
}

public func Expr* BitOffsetExpr.getLHS(BitOffsetExpr* e) { return e.lhs; }
public func Expr** BitOffsetExpr.getLHS2(BitOffsetExpr* e) { return &e.lhs; }

public func Expr* BitOffsetExpr.getRHS(BitOffsetExpr* e) { return e.rhs; }
public func Expr** BitOffsetExpr.getRHS2(BitOffsetExpr* e) { return &e.rhs; }

func void BitOffsetExpr.print(const BitOffsetExpr* e, string_buffer.Buf* out, u32 indent) {
    e.parent.printKind(out, indent);
    e.parent.printTypeBits(out);
    out.add1('\n');
    e.lhs.print(out, indent + 2);
    e.rhs.print(out, indent + 2);
}

